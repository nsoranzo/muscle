UNAME_S := $(shell uname -s)

CXX = g++
CXXFLAGS = -O3 -DNDEBUG -fopenmp -ffast-math -msse -mfpmath=sse

LDFLAGS = -O3 -fopenmp -pthread -lpthread
ifeq ($(UNAME_S),Linux)
    LDFLAGS += -static
endif

HDRS = \
  accaln.h \
  alpha.h \
  alpha3.h \
  clust.h \
  cluster.h \
  clustset.h \
  clustsetdf.h \
  clustsetmsa.h \
  cmds.h \
  countsort.h \
  derep.h \
  diaglist.h \
  distcalc.h \
  distfunc.h \
  dpregionlist.h \
  dpreglist.h \
  eacluster.h \
  edgelist.h \
  enumopts.h \
  enums.h \
  estring.h \
  filebuffer.h \
  gapscoredimer.h \
  gobuff.h \
  gonnet.h \
  guidetree.h \
  hmmparams.h \
  hmmtrans.h \
  intmath.h \
  mpc.h \
  msa.h \
  msadist.h \
  multisequence.h \
  muscle.h \
  myopts.h \
  myutils.h \
  objscore.h \
  pairhmm.h \
  params.h \
  pprog.h \
  probcons.h \
  profile.h \
  pwpath.h \
  qscorer.h \
  qscorer3.h \
  quarts.h \
  scorehistory.h \
  scoretype.h \
  seq.h \
  sequence.h \
  seqvect.h \
  sort.h \
  sparsematrix.h \
  sparsemx.h \
  super4.h \
  super5.h \
  textfile.h \
  timing.h \
  transaln.h \
  tree.h \
  treeperm.h \
  treesplitter.h \
  types.h \
  uclust.h \
  unixio.h \
  upgma5.h \
  usage.h \
  usorter.h \
  ver_counter.h \

OBJS = \
  o/accaln.o \
  o/align.o \
  o/aligngivenpath.o \
  o/aligngivenpathsw.o \
  o/aligntwomsas.o \
  o/aligntwoprofs.o \
  o/aln.o \
  o/alnaln.o \
  o/alnmsas.o \
  o/alpha.o \
  o/alpha3.o \
  o/anchors.o \
  o/assertsameseqs.o \
  o/bittraceback.o \
  o/blosum62.o \
  o/blosumla.o \
  o/buildposterior.o \
  o/buildposterior2.o \
  o/buildposterior3.o \
  o/clust.o \
  o/cluster.o \
  o/clwwt.o \
  o/color.o \
  o/computealn.o \
  o/computebwd.o \
  o/computefwd.o \
  o/computeposterior.o \
  o/computetotalprob.o \
  o/cons.o \
  o/convert.o \
  o/defaulthmmparams.o \
  o/deltahmm.o \
  o/deltahmme.o \
  o/derep.o \
  o/dividetree.o \
  o/diaglist.o \
  o/diffobjscore.o \
  o/diffpaths.o \
  o/difftrees.o \
  o/difftreese.o \
  o/distcalc.o \
  o/distfunc.o \
  o/distmxfromseqvectea.o \
  o/distpwkimura.o \
  o/mpcaccaln.o \
  o/mpc.o \
  o/domuscle.o \
  o/dorelax.o \
  o/dosp.o \
  o/dpreglist.o \
  o/drawtree.o \
  o/eacluster.o \
  o/eadistmx.o \
  o/eadistmxmsas.o \
  o/edgelist.o \
  o/enumopts.o \
  o/enumtostr.o \
  o/estring.o \
  o/fasta.o \
  o/fasta2.o \
  o/fastclust.o \
  o/fastdist.o \
  o/fastdistjones.o \
  o/fastdistkbit.o \
  o/fastdistkmer.o \
  o/fastdistmafft.o \
  o/fastdistnuc.o \
  o/fastscorepath2.o \
  o/progaln5.o \
  o/finddiags.o \
  o/finddiagsn.o \
  o/getconsseq.o \
  o/glbalign.o \
  o/glbaligndiag.o \
  o/glbalignle.o \
  o/glbalignsimple.o \
  o/glbalignsp.o \
  o/glbalignspn.o \
  o/glbalignss.o \
  o/glbalndimer.o \
  o/globalinputms.o \
  o/globals.o \
  o/globalslinux.o \
  o/globalsosx.o \
  o/globalsother.o \
  o/globalswin32.o \
  o/gonnet.o \
  o/guidetreejoinorder.o \
  o/henikoffweight.o \
  o/henikoffweightpb.o \
  o/hmmalignpair.o \
  o/hmmdump.o \
  o/hmmparams.o \
  o/html.o \
  o/hydro.o \
  o/insertgappy.o \
  o/intmath.o \
  o/jointrees.o \
  o/local.o \
  o/logaln.o \
  o/main.o \
  o/msa2tree.o \
  o/msablosumscore.o \
  o/msastats.o \
  o/multisequence.o \
  o/mydist.o \
  o/pc2.o \
  o/pc2x.o \
  o/permutetree.o \
  o/pp.o \
  o/pprog.o \
  o/pprog2.o \
  o/pprogt.o \
  o/probcons.o \
  o/makerootmsa.o \
  o/makerootmsab.o \
  o/maketree.o \
  o/mhack.o \
  o/mpam200.o \
  o/msa.o \
  o/msa2.o \
  o/msadistkimura.o \
  o/msf.o \
  o/muscle.o \
  o/muscleout.o \
  o/myutils.o \
  o/nucmx.o \
  o/nwdasimple.o \
  o/nwdasimple2.o \
  o/nwdasmall.o \
  o/nwrec.o \
  o/nwsmall.o \
  o/objscore.o \
  o/objscore2.o \
  o/objscoreda.o \
  o/onexception.o \
  o/options.o \
  o/outweights.o \
  o/pam200mafft.o \
  o/params.o \
  o/phy.o \
  o/phy2.o \
  o/phy3.o \
  o/phy4.o \
  o/phyfromclust.o \
  o/phyfromfile.o \
  o/physeq.o \
  o/phytofile.o \
  o/posgap.o \
  o/ppscore.o \
  o/pairhmm.o \
  o/processtree.o \
  o/profdb.o \
  o/profile.o \
  o/profilefrommsa.o \
  o/progress.o \
  o/progressivealign.o \
  o/project.o \
  o/pwpath.o \
  o/qscore.o \
  o/qscore2.o \
  o/qscore3.o \
  o/qscorer.o \
  o/quarts.o \
  o/readmx.o \
  o/sequence.o \
  o/setprobconsparams.o \
  o/realigndiffs.o \
  o/refine.o \
  o/refinehoriz.o \
  o/refineprob.o \
  o/refinesubfams.o \
  o/refinetree.o \
  o/refinevert.o \
  o/relax.o \
  o/relax1.o \
  o/savebest.o \
  o/scoredist.o \
  o/scoregaps.o \
  o/scorehistory.o \
  o/scorepp.o \
  o/seq.o \
  o/seqvect.o \
  o/setblosumweights.o \
  o/setgscweights.o \
  o/setnewhandler.o \
  o/sparsematrix.o \
  o/sparsemx.o \
  o/spfast.o \
  o/sptest.o \
  o/stabilize.o \
  o/stripgappycols.o \
  o/super4.o \
  o/super5.o \
  o/sw.o \
  o/termgaps.o \
  o/textfile.o \
  o/threewaywt.o \
  o/tomhydro.o \
  o/traceback.o \
  o/tracebackopt.o \
  o/tracebacksw.o \
  o/trainhmm.o \
  o/transaln.o \
  o/transq.o \
  o/treefrommsa.o \
  o/treefrommsa5.o \
  o/treefromseqvectea.o \
  o/treenode.o \
  o/treesplitter.o \
  o/treesubsetnodes.o \
  o/typetostr.o \
  o/uclust.o \
  o/upgma2.o \
  o/upgma5.o \
  o/usage.o \
  o/usorter.o \
  o/validateids.o \
  o/vtml2.o \
  o/writescorefile.o \

.PHONY: clean

o/muscle5 : o/ $(OBJS)
	$(CXX) $(LDFLAGS) $(OBJS) -o $@
	strip -d o/muscle5

o/ :
	mkdir -p o/

o/%.o : %.cpp $(HDRS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

clean:
	-rm -rf o/
